

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Feng Tao">
  <meta name="keywords" content="">
  
    <meta name="description" content="项目：user_system">
<meta property="og:type" content="article">
<meta property="og:title" content="user_system项目">
<meta property="og:url" content="http://example.com/2023/04/18/user-system%E9%A1%B9%E7%9B%AE/index.html">
<meta property="og:site_name" content="小樱桃">
<meta property="og:description" content="项目：user_system">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-04-18T06:57:31.000Z">
<meta property="article:modified_time" content="2023-04-18T10:27:41.122Z">
<meta property="article:author" content="Feng Tao">
<meta property="article:tag" content="GO">
<meta property="article:tag" content="项目">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>user_system项目 - 小樱桃</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/fluid-extension.css">
<link rel="stylesheet" href="/css/test.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"n0H6ZjcwsAdPc2zfOJM4bxV4-gzGzoHsz","app_key":"rwjeQIHfYJqQvjh2iWuPkYev","server_url":"https://n0h6zjcw.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>小樱桃的个人博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/5.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="user_system项目"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-04-18 14:57" pubdate>
          2023年4月18日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          22k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          180 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">user_system项目</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="项目：user-system"><a href="#项目：user-system" class="headerlink" title="项目：user_system"></a>项目：user_system<span id="more"></span></h1><p><strong>下面是对于各个目录下的各个文件的函数的讲解。</strong></p>
<h2 id="1、config包"><a href="#1、config包" class="headerlink" title="1、config包"></a>1、config包</h2><h3 id="（1）config-go"><a href="#（1）config-go" class="headerlink" title="（1）config.go"></a>（1）config.go</h3><p>​	这是一个 Go 语言的配置包，用于读取并解析配置文件。该包使用了 viper 库，可以读取 YAML 格式的配置文件。其中定义了一些结构体，分别对应了不同的配置项，例如日志配置、数据库配置、Redis 配置等等。使用者可以通过调用 <code>GetGlobalConf()</code> 函数获取全局配置文件，也可以通过调用 <code>InitConfig()</code> 函数来初始化日志。在 <code>InitConfig()</code> 函数中，会先获取全局配置文件，然后根据配置文件中的日志级别和输出方式等参数进行初始化，同时设置日志格式为 JSON 格式，并且打印文件位置和行号等信息。最后根据配置文件中的输出方式，将日志输出到终端或者文件中。</p>
<h4 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> (<br>   config GlobalConfig <span class="hljs-comment">// 全局业务配置文件</span><br>   once   sync.Once<br>)<br></code></pre></td></tr></table></figure>

<p>​	配置全局业务配置文件，便于文件内的使用。</p>
<hr>
<h4 id="LogConf类型日志配置"><a href="#LogConf类型日志配置" class="headerlink" title="LogConf类型	日志配置"></a>LogConf类型	日志配置</h4><p>​	<strong>日志输出的相关配置信息</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//LogConf 日志配置</span><br><span class="hljs-keyword">type</span> LogConf <span class="hljs-keyword">struct</span> &#123;<br>	LogPattern <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;log_pattern&quot; mapstructure:&quot;log_pattern&quot;`</span> <span class="hljs-comment">// 日志输出标准，终端输出/文件输出</span><br>	LogPath    <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;log_path&quot; mapstructure:&quot;log_path&quot;`</span>       <span class="hljs-comment">// 表示日志输出到文件时的路径。</span><br>	SaveDays   <span class="hljs-type">uint</span>   <span class="hljs-string">`yaml:&quot;save_days&quot; mapstructure:&quot;save_days&quot;`</span>     <span class="hljs-comment">// 表示日志保存的天数，过期的日志文件将被删除。</span><br>	Level      <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;level&quot; mapstructure:&quot;level&quot;`</span>             <span class="hljs-comment">// 表示日志输出的级别，包括 DEBUG、INFO、WARN、ERROR、FATAL 等级别，级别从低到高依次增强。</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	结构体中的 <code>yaml</code> 和 <code>mapstructure</code> 标签是用于指定将结构体序列化和反序列化为YAML和Map类型时，如何将结构体字段映射到YAML或Map中的键名。</p>
<p>​	具体来说，<code>yaml:&quot;log_pattern&quot;</code> 表示在序列化为YAML格式时，<code>LogPattern</code> 字段将被映射到键名为 <code>log_pattern</code> 的YAML键；<code>mapstructure:&quot;log_pattern&quot;</code> 则表示在反序列化时，YAML中的 <code>log_pattern</code> 键将被映射到 <code>LogPattern</code> 字段。</p>
<p>​	类似的，<code>yaml:&quot;log_path&quot;</code> 和 <code>mapstructure:&quot;log_path&quot;</code> 表示 <code>LogPath</code> 字段的映射关系；<code>yaml:&quot;save_days&quot;</code> 和 <code>mapstructure:&quot;save_days&quot;</code> 表示 <code>SaveDays</code> 字段的映射关系；<code>yaml:&quot;level&quot;</code> 和 <code>mapstructure:&quot;level&quot;</code> 表示 <code>Level</code> 字段的映射关系。这些标签的使用使得在不同的格式中读取和写入配置变得更加方便。</p>
<hr>
<h4 id="DbConf类型db配置结构"><a href="#DbConf类型db配置结构" class="headerlink" title="DbConf类型	db配置结构"></a>DbConf类型	db配置结构</h4><p>​	<strong>数据库连接的相关配置信息</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> DbConf <span class="hljs-keyword">struct</span> &#123;<br>	Host        <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;host&quot; mapstructure:&quot;host&quot;`</span>                   <span class="hljs-comment">// db主机地址</span><br>	Port        <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;port&quot; mapstructure:&quot;port&quot;`</span>                   <span class="hljs-comment">// db端口</span><br>	User        <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;user&quot; mapstructure:&quot;user&quot;`</span>                   <span class="hljs-comment">// 用户名</span><br>	Password    <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;password&quot; mapstructure:&quot;password&quot;`</span>           <span class="hljs-comment">// 密码</span><br>	Dbname      <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;dbname&quot; mapstructure:&quot;dbname&quot;`</span>               <span class="hljs-comment">// db名</span><br>	MaxIdleConn <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;max_idle_conn&quot; mapstructure:&quot;max_idle_conn&quot;`</span> <span class="hljs-comment">// 最大空闲连接数</span><br>	MaxOpenConn <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;max_open_conn&quot; mapstructure:&quot;max_open_conn&quot;`</span> <span class="hljs-comment">// 最大打开的连接数</span><br>	MaxIdleTime <span class="hljs-type">int64</span>  <span class="hljs-string">`yaml:&quot;max_idle_time&quot; mapstructure:&quot;max_idle_time&quot;`</span> <span class="hljs-comment">// 连接最大空闲时间</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>结构体中的 <code>yaml</code> 和 <code>mapstructure</code> 标签作用如上所述，在后续中也不再赘述。</p>
<hr>
<h4 id="AppConf类型服务配置"><a href="#AppConf类型服务配置" class="headerlink" title="AppConf类型	服务配置"></a>AppConf类型	服务配置</h4><p>​	<strong>描述应用程序的基本配置信息</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> AppConf <span class="hljs-keyword">struct</span> &#123;<br>	AppName <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;app_name&quot; mapstructure:&quot;app_name&quot;`</span> <span class="hljs-comment">// 业务名</span><br>	Version <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;version&quot; mapstructure:&quot;version&quot;`</span>   <span class="hljs-comment">// 版本</span><br>	Port    <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;port&quot; mapstructure:&quot;port&quot;`</span>         <span class="hljs-comment">// 端口</span><br>	RunMode <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;run_mode&quot; mapstructure:&quot;run_mode&quot;`</span> <span class="hljs-comment">// 运行模式</span><br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h4 id="RedisConf类型配置"><a href="#RedisConf类型配置" class="headerlink" title="RedisConf类型	配置"></a>RedisConf类型	配置</h4><p>​	<strong>描述 Redis 数据库的配置信息</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> RedisConf <span class="hljs-keyword">struct</span> &#123;<br>	Host     <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;rhost&quot; mapstructure:&quot;rhost&quot;`</span> <span class="hljs-comment">// db主机地址</span><br>	Port     <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;rport&quot; mapstructure:&quot;rport&quot;`</span> <span class="hljs-comment">// db端口</span><br>	DB       <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;rdb&quot; mapstructure:&quot;rdb&quot;`</span> <span class="hljs-comment">//表示 Redis 服务器上的哪个数据库，从0到15共16个数据库。</span><br>	PassWord <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;passwd&quot; mapstructure:&quot;passwd&quot;`</span> <span class="hljs-comment">//表示连接 Redis 服务器所需的密码，如果没有设置密码则该字段为空字符串。</span><br>	PoolSize <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;poolsize&quot; mapstructure:&quot;poolsize&quot;`</span>	<span class="hljs-comment">//连接池的大小，即最大连接数。</span><br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h4 id="Cache类型缓存"><a href="#Cache类型缓存" class="headerlink" title="Cache类型	缓存"></a>Cache类型	缓存</h4><p>​	<strong>定义了缓存相关的配置信息</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Cache <span class="hljs-keyword">struct</span> &#123;<br>	SessionExpired <span class="hljs-type">int</span> <span class="hljs-string">`yaml:&quot;session_expired&quot; mapstructure:&quot;session_expired&quot;`</span> <span class="hljs-comment">//表示会话过期时间</span><br>	UserExpired    <span class="hljs-type">int</span> <span class="hljs-string">`yaml:&quot;user_expired&quot; mapstructure:&quot;user_expired&quot;`</span>       <span class="hljs-comment">//表示用户信息过期时间</span><br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h4 id="GlobalConfig函数业务配置结构体"><a href="#GlobalConfig函数业务配置结构体" class="headerlink" title="GlobalConfig函数	业务配置结构体"></a>GlobalConfig函数	业务配置结构体</h4><p>​	<strong>根据嵌套自定义的结构体业务配置结构体</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> GlobalConfig <span class="hljs-keyword">struct</span> &#123;<br>	AppConfig   AppConf   <span class="hljs-string">`yaml:&quot;app&quot; mapstructure:&quot;app&quot;`</span><br>	CorsOrigin  []<span class="hljs-type">string</span>  <span class="hljs-string">`yaml:&quot;cors_origin&quot; mapstructure:&quot;cors_origin&quot;`</span> <span class="hljs-comment">// 跨域源列表</span><br>	DbConfig    DbConf    <span class="hljs-string">`yaml:&quot;db&quot; mapstructure:&quot;db&quot;`</span>                   <span class="hljs-comment">// db配置</span><br>	LogConfig   LogConf   <span class="hljs-string">`yaml:&quot;log&quot; mapstructure:&quot;log&quot;`</span>                 <span class="hljs-comment">// 日志配置</span><br>	RedisConfig RedisConf <span class="hljs-string">`yaml:&quot;redis&quot; mapstructure:&quot;redis&quot;`</span>             <span class="hljs-comment">// redis配置</span><br>	Cache       Cache     <span class="hljs-string">`yaml:&quot;cache&quot; mapstructure:&quot;cache&quot;`</span>             <span class="hljs-comment">// cache配置</span><br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h4 id="readConf函数读取应用程序配置文件"><a href="#readConf函数读取应用程序配置文件" class="headerlink" title="readConf函数	读取应用程序配置文件"></a>readConf函数	读取应用程序配置文件</h4><p>​	<strong>使用 viper 库读取 YAML 格式的配置文件，并将配置信息解析到 <code>config</code> 变量中。</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">readConf</span><span class="hljs-params">()</span></span> &#123;<br>	viper.SetConfigName(<span class="hljs-string">&quot;app&quot;</span>)<br>	viper.SetConfigType(<span class="hljs-string">&quot;yml&quot;</span>)<br>	viper.AddConfigPath(<span class="hljs-string">&quot;.&quot;</span>)<br>	viper.AddConfigPath(<span class="hljs-string">&quot;./conf&quot;</span>)<br>	viper.AddConfigPath(<span class="hljs-string">&quot;../conf&quot;</span>)<br>	err := viper.ReadInConfig()<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;read config file err:&quot;</span> + err.Error())<br>	&#125;<br>	err = viper.Unmarshal(&amp;config)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;config file unmarshal err:&quot;</span> + err.Error())<br>	&#125;<br>	log.Infof(<span class="hljs-string">&quot;config === %+v&quot;</span>, config)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	在函数内部，首先通过 <code>viper.SetConfigName()</code>、<code>viper.SetConfigType()</code> 和 <code>viper.AddConfigPath()</code> 函数指定了配置文件的名称、类型和路径，然后通过 <code>viper.ReadInConfig()</code> 函数读取配置文件。</p>
<p>​	读取配置文件后，使用 <code>viper.Unmarshal()</code> 函数将配置信息解析到 <code>config</code> 变量中，解析过程中会按照结构体成员的标签信息来读取配置项的值。</p>
<p>​	最后，在解析完成后，使用日志库打印出读取到的配置信息，并将 <code>config</code> 变量保存在全局变量中供后续使用。需要注意的是，为了保证全局变量只被初始化一次，这里使用了 <code>sync.Once</code> 来实现懒汉式单例模式。</p>
<hr>
<h4 id="GetGlobalConf函数获取全局配置文件"><a href="#GetGlobalConf函数获取全局配置文件" class="headerlink" title="GetGlobalConf函数	获取全局配置文件"></a>GetGlobalConf函数	获取全局配置文件</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetGlobalConf</span><span class="hljs-params">()</span></span> *GlobalConfig &#123;<br>	once.Do(readConf)<br>	<span class="hljs-keyword">return</span> &amp;config<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	这段代码定义了一个函数 <code>GetGlobalConf()</code>，它返回一个指向 <code>GlobalConfig</code> 结构体的指针。该函数使用了 <code>sync.Once</code> 类型的变量 <code>once</code>，以确保 <code>readConf()</code> 函数只被调用一次来读取配置文件，并将解析的结果存储在 <code>config</code> 变量中。 <code>readConf()</code> 函数负责从配置文件中读取配置信息，并使用 <code>viper</code> 库解析 YAML 格式的配置文件。</p>
<hr>
<h4 id="InitConfig函数初始化日志"><a href="#InitConfig函数初始化日志" class="headerlink" title="InitConfig函数	初始化日志"></a>InitConfig函数	初始化日志</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitConfig</span><span class="hljs-params">()</span></span> &#123;<br>	globalConf := GetGlobalConf() <span class="hljs-comment">//获取全局配置文件</span><br>	<span class="hljs-comment">// 设置日志级别</span><br>	level, err := log.ParseLevel(globalConf.LogConfig.Level)	<span class="hljs-comment">//实现字符串到log.Level类型的转换</span><br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;log level parse err:&quot;</span> + err.Error())<br>	&#125;<br>	<span class="hljs-comment">// 设置日志格式为json格式</span><br>	log.SetFormatter(&amp;logFormatter&#123;<br>		log.TextFormatter&#123;<br>			DisableColors:   <span class="hljs-literal">true</span>,<br>			TimestampFormat: <span class="hljs-string">&quot;2006-01-02 15:04:05&quot;</span>,<br>			FullTimestamp:   <span class="hljs-literal">true</span>,<br>		&#125;&#125;)<br>	log.SetReportCaller(<span class="hljs-literal">true</span>) <span class="hljs-comment">// 打印文件位置，行号</span><br>	log.SetLevel(level)       <span class="hljs-comment">//设置日志的记录级别</span><br>	<span class="hljs-keyword">switch</span> globalConf.LogConfig.LogPattern &#123;<br>	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;stdout&quot;</span>:<br>		log.SetOutput(os.Stdout)<br>	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;stderr&quot;</span>:<br>		log.SetOutput(os.Stderr)<br>	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;file&quot;</span>:<br>		logger, err := rlog.New(<br>			globalConf.LogConfig.LogPath+<span class="hljs-string">&quot;.%Y%m%d&quot;</span>,<br>			<span class="hljs-comment">//rlog.WithLinkName(globalConf.LogConf.LogPath),</span><br>			rlog.WithRotationCount(globalConf.LogConfig.SaveDays),<br>			<span class="hljs-comment">//rlog.WithMaxAge(time.Minute*3),</span><br>			rlog.WithRotationTime(time.Hour*<span class="hljs-number">24</span>),<br>		)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;log conf err: &quot;</span> + err.Error())<br>		&#125;<br>		log.SetOutput(logger)<br>	<span class="hljs-keyword">default</span>:<br>		<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;log conf err, check log_pattern in logsvr.yaml&quot;</span>)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	首先，它调用<code>GetGlobalConf()</code>函数获取全局配置；接着，根据配置设置日志级别、格式和输出方式。</p>
<p>​	全局配置文件中的日志级别是字符串类型，需要转换为logrus包中的log.Level类型，以便于后续日志记录和输出。这里使用了logrus包中的ParseLevel函数来实现字符串到log.Level类型的转换。如果解析失败，err不为nil，否则level变量存储解析得到的日志级别。</p>
<p><code>log.SetOutput</code>：是一个函数，它设置logger输出的目的地。它需要一个io.Writer类型的参数，通常会传入os.Stdout（标准输出）或os.Stderr（标准错误输出）来控制日志信息的输出位置。</p>
<p>​	最后，根据全局配置中的日志输出标准<code>globalConf.LogConfig.LogPattern</code>来设置日志输出位置，可以是标准输出<code>stdout</code>、标准错误输出<code>stderr</code>或文件输出<code>file</code>，文件输出需要指定文件路径和日志保留时间。如果日志输出标准不合法，则会抛出异常。</p>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> config<br><br><span class="hljs-keyword">import</span> (<br>	rlog <span class="hljs-string">&quot;github.com/lestrrat-go/file-rotatelogs&quot;</span><br>	log <span class="hljs-string">&quot;github.com/sirupsen/logrus&quot;</span><br>	<span class="hljs-string">&quot;os&quot;</span><br>	<span class="hljs-string">&quot;sync&quot;</span><br>	<span class="hljs-string">&quot;time&quot;</span><br><br>	<span class="hljs-string">&quot;github.com/spf13/viper&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> (<br>	config GlobalConfig <span class="hljs-comment">// 全局业务配置文件</span><br>	once   sync.Once<br>)<br><br><span class="hljs-comment">// LogConf 日志配置</span><br><span class="hljs-keyword">type</span> LogConf <span class="hljs-keyword">struct</span> &#123;<br>	LogPattern <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;log_pattern&quot; mapstructure:&quot;log_pattern&quot;`</span> <span class="hljs-comment">// 日志输出标准，终端输出/文件输出</span><br>	LogPath    <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;log_path&quot; mapstructure:&quot;log_path&quot;`</span>       <span class="hljs-comment">// 日志路径</span><br>	SaveDays   <span class="hljs-type">uint</span>   <span class="hljs-string">`yaml:&quot;save_days&quot; mapstructure:&quot;save_days&quot;`</span>     <span class="hljs-comment">// 日志保存天数</span><br>	Level      <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;level&quot; mapstructure:&quot;level&quot;`</span>             <span class="hljs-comment">// 日志级别</span><br>&#125;<br><br><span class="hljs-comment">// DbConf db配置结构</span><br><span class="hljs-keyword">type</span> DbConf <span class="hljs-keyword">struct</span> &#123;<br>	Host        <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;host&quot; mapstructure:&quot;host&quot;`</span>                   <span class="hljs-comment">// db主机地址</span><br>	Port        <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;port&quot; mapstructure:&quot;port&quot;`</span>                   <span class="hljs-comment">// db端口</span><br>	User        <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;user&quot; mapstructure:&quot;user&quot;`</span>                   <span class="hljs-comment">// 用户名</span><br>	Password    <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;password&quot; mapstructure:&quot;password&quot;`</span>           <span class="hljs-comment">// 密码</span><br>	Dbname      <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;dbname&quot; mapstructure:&quot;dbname&quot;`</span>               <span class="hljs-comment">// db名</span><br>	MaxIdleConn <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;max_idle_conn&quot; mapstructure:&quot;max_idle_conn&quot;`</span> <span class="hljs-comment">// 最大空闲连接数</span><br>	MaxOpenConn <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;max_open_conn&quot; mapstructure:&quot;max_open_conn&quot;`</span> <span class="hljs-comment">// 最大打开的连接数</span><br>	MaxIdleTime <span class="hljs-type">int64</span>  <span class="hljs-string">`yaml:&quot;max_idle_time&quot; mapstructure:&quot;max_idle_time&quot;`</span> <span class="hljs-comment">// 连接最大空闲时间</span><br>&#125;<br><br><span class="hljs-comment">// AppConf 服务配置</span><br><span class="hljs-keyword">type</span> AppConf <span class="hljs-keyword">struct</span> &#123;<br>	AppName <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;app_name&quot; mapstructure:&quot;app_name&quot;`</span> <span class="hljs-comment">// 业务名</span><br>	Version <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;version&quot; mapstructure:&quot;version&quot;`</span>   <span class="hljs-comment">// 版本</span><br>	Port    <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;port&quot; mapstructure:&quot;port&quot;`</span>         <span class="hljs-comment">// 端口</span><br>	RunMode <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;run_mode&quot; mapstructure:&quot;run_mode&quot;`</span> <span class="hljs-comment">// 运行模式</span><br>&#125;<br><br><span class="hljs-comment">// RedisConf 配置</span><br><span class="hljs-keyword">type</span> RedisConf <span class="hljs-keyword">struct</span> &#123;<br>	Host     <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;rhost&quot; mapstructure:&quot;rhost&quot;`</span>       <span class="hljs-comment">// db主机地址</span><br>	Port     <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;rport&quot; mapstructure:&quot;rport&quot;`</span>       <span class="hljs-comment">// db端口</span><br>	DB       <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;rdb&quot; mapstructure:&quot;rdb&quot;`</span>           <span class="hljs-comment">//表示 Redis 服务器上的哪个数据库，从0到15共16个数据库。</span><br>	PassWord <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;passwd&quot; mapstructure:&quot;passwd&quot;`</span>     <span class="hljs-comment">//表示连接 Redis 服务器所需的密码，如果没有设置密码则该字段为空字符串。</span><br>	PoolSize <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;poolsize&quot; mapstructure:&quot;poolsize&quot;`</span> <span class="hljs-comment">//连接池的大小，即最大连接数。</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Cache <span class="hljs-keyword">struct</span> &#123;<br>	SessionExpired <span class="hljs-type">int</span> <span class="hljs-string">`yaml:&quot;session_expired&quot; mapstructure:&quot;session_expired&quot;`</span> <span class="hljs-comment">//表示会话过期时间</span><br>	UserExpired    <span class="hljs-type">int</span> <span class="hljs-string">`yaml:&quot;user_expired&quot; mapstructure:&quot;user_expired&quot;`</span>       <span class="hljs-comment">//表示用户信息过期时间</span><br>&#125;<br><br><span class="hljs-comment">// GlobalConfig 业务配置结构体</span><br><span class="hljs-keyword">type</span> GlobalConfig <span class="hljs-keyword">struct</span> &#123;<br>	AppConfig   AppConf   <span class="hljs-string">`yaml:&quot;app&quot; mapstructure:&quot;app&quot;`</span><br>	CorsOrigin  []<span class="hljs-type">string</span>  <span class="hljs-string">`yaml:&quot;cors_origin&quot; mapstructure:&quot;cors_origin&quot;`</span> <span class="hljs-comment">// 跨域源列表</span><br>	DbConfig    DbConf    <span class="hljs-string">`yaml:&quot;db&quot; mapstructure:&quot;db&quot;`</span>                   <span class="hljs-comment">// db配置</span><br>	LogConfig   LogConf   <span class="hljs-string">`yaml:&quot;log&quot; mapstructure:&quot;log&quot;`</span>                 <span class="hljs-comment">// 日志配置</span><br>	RedisConfig RedisConf <span class="hljs-string">`yaml:&quot;redis&quot; mapstructure:&quot;redis&quot;`</span>             <span class="hljs-comment">// redis配置</span><br>	Cache       Cache     <span class="hljs-string">`yaml:&quot;cache&quot; mapstructure:&quot;cache&quot;`</span>             <span class="hljs-comment">// cache配置</span><br>&#125;<br><br><span class="hljs-comment">// GetGlobalConf 获取全局配置文件</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetGlobalConf</span><span class="hljs-params">()</span></span> *GlobalConfig &#123;<br>	once.Do(readConf)<br>	<span class="hljs-keyword">return</span> &amp;config<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">readConf</span><span class="hljs-params">()</span></span> &#123;<br>	viper.SetConfigName(<span class="hljs-string">&quot;app&quot;</span>)<br>	viper.SetConfigType(<span class="hljs-string">&quot;yml&quot;</span>)<br>	viper.AddConfigPath(<span class="hljs-string">&quot;.&quot;</span>)<br>	viper.AddConfigPath(<span class="hljs-string">&quot;./conf&quot;</span>)<br>	viper.AddConfigPath(<span class="hljs-string">&quot;../conf&quot;</span>)<br>	err := viper.ReadInConfig()<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;read config file err:&quot;</span> + err.Error())<br>	&#125;<br>	err = viper.Unmarshal(&amp;config)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;config file unmarshal err:&quot;</span> + err.Error())<br>	&#125;<br>	log.Infof(<span class="hljs-string">&quot;config === %+v&quot;</span>, config)<br>&#125;<br><br><span class="hljs-comment">// InitConfig 初始化日志</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitConfig</span><span class="hljs-params">()</span></span> &#123;<br>	globalConf := GetGlobalConf() <span class="hljs-comment">//获取全局配置文件</span><br>	<span class="hljs-comment">// 设置日志级别</span><br>	level, err := log.ParseLevel(globalConf.LogConfig.Level) <span class="hljs-comment">//实现字符串到log.Level类型的转换</span><br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;log level parse err:&quot;</span> + err.Error())<br>	&#125;<br>	<span class="hljs-comment">// 设置日志格式为json格式</span><br>	log.SetFormatter(&amp;logFormatter&#123;<br>		log.TextFormatter&#123;<br>			DisableColors:   <span class="hljs-literal">true</span>,<br>			TimestampFormat: <span class="hljs-string">&quot;2006-01-02 15:04:05&quot;</span>,<br>			FullTimestamp:   <span class="hljs-literal">true</span>,<br>		&#125;&#125;)<br>	log.SetReportCaller(<span class="hljs-literal">true</span>) <span class="hljs-comment">// 打印文件位置，行号</span><br>	log.SetLevel(level)       <span class="hljs-comment">//设置日志的记录级别</span><br>	<span class="hljs-keyword">switch</span> globalConf.LogConfig.LogPattern &#123;<br>	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;stdout&quot;</span>:<br>		log.SetOutput(os.Stdout)<br>	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;stderr&quot;</span>:<br>		log.SetOutput(os.Stderr)<br>	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;file&quot;</span>:<br>		logger, err := rlog.New(<br>			globalConf.LogConfig.LogPath+<span class="hljs-string">&quot;.%Y%m%d&quot;</span>,<br>			<span class="hljs-comment">//rlog.WithLinkName(globalConf.LogConf.LogPath),</span><br>			rlog.WithRotationCount(globalConf.LogConfig.SaveDays),<br>			<span class="hljs-comment">//rlog.WithMaxAge(time.Minute*3),</span><br>			rlog.WithRotationTime(time.Hour*<span class="hljs-number">24</span>),<br>		)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;log conf err: &quot;</span> + err.Error())<br>		&#125;<br>		log.SetOutput(logger)<br>	<span class="hljs-keyword">default</span>:<br>		<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;log conf err, check log_pattern in logsvr.yaml&quot;</span>)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="（2）log-go"><a href="#（2）log-go" class="headerlink" title="（2）log.go"></a>（2）log.go</h3><p>​	这是一个 Go 语言包(package)的实现，其中包含了以下函数和结构体：</p>
<ol>
<li><code>logFormatter</code>：自定义的日志格式化结构体，包含 <code>Format</code> 方法，用于格式化日志输出。</li>
<li><code>setGinLog</code>：设置 Gin 框架的日志输出目标的函数，将日志输出到指定的 io.Writer 对象中。</li>
</ol>
<p>具体来说，<code>logFormatter</code> 结构体重写了 <code>TextFormatter</code> 的 <code>Format</code> 方法，通过调用 <code>prettyCaller</code> 函数来输出日志所在的文件和行号信息，同时输出日志时间、日志等级和日志内容，并返回格式化后的字节数组。</p>
<p>在 <code>setGinLog</code> 函数中，通过将 <code>out</code> 参数赋值给 <code>gin.DefaultWriter</code> 和 <code>gin.DefaultErrorWriter</code>，将 Gin 框架的日志输出目标设置为指定的 io.Writer 对象，以此来实现日志的输出。</p>
<h4 id="logFormatter类型"><a href="#logFormatter类型" class="headerlink" title="logFormatter	类型"></a>logFormatter	类型</h4><p>​	<strong>tabFormatter tab数据格式化</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> logFormatter <span class="hljs-keyword">struct</span> &#123;<br>	log.TextFormatter<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	定义了一个新的类型 <code>logFormatter</code>，它是 <code>log.TextFormatter</code> 的子类型。</p>
<p>​	换句话说，<code>logFormatter</code> 继承了 <code>log.TextFormatter</code> 中定义的所有属性和方法，并且可以在此基础上添加额外的属性和方法。</p>
<p>​	这种方式称为组合，即将一个或多个类型组合成一个新类型。在这个例子中，<code>logFormatter</code> 可以用来定制化 <code>logrus</code> 日志库中的日志格式。</p>
<h4 id="Format函数"><a href="#Format函数" class="headerlink" title="Format	函数"></a>Format	函数</h4><p>​	<strong>自定义日志输出格式</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *logFormatter)</span></span> Format(entry *log.Entry) ([]<span class="hljs-type">byte</span>, <span class="hljs-type">error</span>) &#123;<br>	prettyCaller := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(frame *runtime.Frame)</span></span> <span class="hljs-type">string</span> &#123;<br>		_, fileName := filepath.Split(frame.File)<br>		<span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">&quot;%s:%d&quot;</span>, fileName, frame.Line)<br>	&#125;<br>	<span class="hljs-keyword">var</span> b *bytes.Buffer<br>	<span class="hljs-keyword">if</span> entry.Buffer != <span class="hljs-literal">nil</span> &#123;<br>		b = entry.Buffer<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		b = &amp;bytes.Buffer&#123;&#125;<br>	&#125;<br>	b.WriteString(fmt.Sprintf(<span class="hljs-string">&quot;[%s] %s&quot;</span>, entry.Time.Format(c.TimestampFormat), <span class="hljs-comment">// 输出日志时间</span><br>		strings.ToUpper(entry.Level.String())))<br>	<span class="hljs-keyword">if</span> entry.HasCaller() &#123;<br>		b.WriteString(fmt.Sprintf(<span class="hljs-string">&quot;[%s]&quot;</span>, prettyCaller(entry.Caller))) <span class="hljs-comment">// 输出日志所在文件，行数位置</span><br>	&#125;<br>	b.WriteString(fmt.Sprintf(<span class="hljs-string">&quot; %s\n&quot;</span>, entry.Message)) <span class="hljs-comment">// 输出日志内容</span><br>	<span class="hljs-keyword">return</span> b.Bytes(), <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	定义了一个实现了 log.Formatter 接口的 logFormatter 结构体，并实现了 Format 方法，用于格式化日志输出。具体来说，Format 方法会接收一个 log.Entry 结构体指针作为参数，该结构体包含了日志的时间、级别、消息内容等信息，并返回一个字节数组和一个错误对象。</p>
<p>​	在 Format 方法中，首先定义了一个 prettyCaller 函数，用于获取日志输出所在文件和行数。然后，根据传入的 log.Entry 指针中的信息，将时间、级别、所在位置、消息内容等信息依次输出到一个 bytes.Buffer 对象中，并最终返回该对象的字节数组表示。</p>
<p>​	此外，还定义了一个名为 setGinLog 的函数，用于设置 gin 框架的日志输出到指定的 io.Writer 对象，通常用于将 gin 的日志输出到文件中。</p>
<h4 id="setGinLog函数"><a href="#setGinLog函数" class="headerlink" title="setGinLog	函数"></a>setGinLog	函数</h4><p>​	<strong>修改 <code>gin</code> 框架的日志输出位置</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setGinLog</span><span class="hljs-params">(out io.Writer)</span></span> &#123;<br>	gin.DefaultWriter = out<br>	gin.DefaultErrorWriter = out<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	接收一个实现了 <code>io.Writer</code> 接口的对象作为参数 <code>out</code>。在函数内部，将 <code>gin</code> 框架的默认日志输出和错误输出都设置为 <code>out</code>。也就是说，通过调用这个函数可以修改 <code>gin</code> 框架的日志输出位置。</p>
<h4 id="完整代码-1"><a href="#完整代码-1" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> config<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;bytes&quot;</span><br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	log <span class="hljs-string">&quot;github.com/sirupsen/logrus&quot;</span><br>	<span class="hljs-string">&quot;io&quot;</span><br>	<span class="hljs-string">&quot;path/filepath&quot;</span><br>	<span class="hljs-string">&quot;runtime&quot;</span><br>	<span class="hljs-string">&quot;strings&quot;</span><br>)<br><br><span class="hljs-comment">//tabFormatter tab数据格式化</span><br><span class="hljs-keyword">type</span> logFormatter <span class="hljs-keyword">struct</span> &#123;<br>	log.TextFormatter<br>&#125;<br><br><span class="hljs-comment">// Format 自定义日志输出格式</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *logFormatter)</span></span> Format(entry *log.Entry) ([]<span class="hljs-type">byte</span>, <span class="hljs-type">error</span>) &#123;<br>	prettyCaller := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(frame *runtime.Frame)</span></span> <span class="hljs-type">string</span> &#123;<br>		_, fileName := filepath.Split(frame.File)<br>		<span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">&quot;%s:%d&quot;</span>, fileName, frame.Line)<br>	&#125;<br>	<span class="hljs-keyword">var</span> b *bytes.Buffer<br>	<span class="hljs-keyword">if</span> entry.Buffer != <span class="hljs-literal">nil</span> &#123;<br>		b = entry.Buffer<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		b = &amp;bytes.Buffer&#123;&#125;<br>	&#125;<br>	b.WriteString(fmt.Sprintf(<span class="hljs-string">&quot;[%s] %s&quot;</span>, entry.Time.Format(c.TimestampFormat), <span class="hljs-comment">// 输出日志时间</span><br>		strings.ToUpper(entry.Level.String())))<br>	<span class="hljs-keyword">if</span> entry.HasCaller() &#123;<br>		b.WriteString(fmt.Sprintf(<span class="hljs-string">&quot;[%s]&quot;</span>, prettyCaller(entry.Caller))) <span class="hljs-comment">// 输出日志所在文件，行数位置</span><br>	&#125;<br>	b.WriteString(fmt.Sprintf(<span class="hljs-string">&quot; %s\n&quot;</span>, entry.Message)) <span class="hljs-comment">// 输出日志内容</span><br>	<span class="hljs-keyword">return</span> b.Bytes(), <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setGinLog</span><span class="hljs-params">(out io.Writer)</span></span> &#123;<br>	gin.DefaultWriter = out<br>	gin.DefaultErrorWriter = out<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="2、internal包"><a href="#2、internal包" class="headerlink" title="2、internal包"></a>2、internal包</h2><h3 id="（1）router包"><a href="#（1）router包" class="headerlink" title="（1）router包"></a>（1）router包</h3><h4 id="①-router-go"><a href="#①-router-go" class="headerlink" title="① router.go"></a>① router.go</h4><h5 id="setAppRunMode设置运行模式"><a href="#setAppRunMode设置运行模式" class="headerlink" title="setAppRunMode	设置运行模式"></a>setAppRunMode	设置运行模式</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setAppRunMode</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-keyword">if</span> config.GetGlobalConf().AppConfig.RunMode == <span class="hljs-string">&quot;release&quot;</span> &#123;<br>		gin.SetMode(gin.ReleaseMode)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	用于设置应用程序运行模式。如果全局配置中的 <code>AppConfig.RunMode</code> 设置为 <code>&quot;release&quot;</code>，那么会将 Gin 框架的模式设置为 Release 模式。</p>
<p>​	在 Release 模式下，Gin 框架会禁用一些调试信息和中间件，以提高应用程序的运行效率和安全性。这是一个常见的最佳实践，特别是在生产环境中。</p>
<h4 id="②AuthMiddleWare函数"><a href="#②AuthMiddleWare函数" class="headerlink" title="②AuthMiddleWare函数"></a>②AuthMiddleWare函数</h4><p>​	验证用户身份是否合法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AuthMiddleWare</span><span class="hljs-params">()</span></span> gin.HandlerFunc &#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		<span class="hljs-keyword">if</span> session, err := c.Cookie(constant.SessionKey); err == <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-keyword">if</span> session != <span class="hljs-string">&quot;&quot;</span> &#123;<br>				c.Next()<br>				<span class="hljs-keyword">return</span><br>			&#125;<br>		&#125;<br>		<span class="hljs-comment">// 返回错误</span><br>		c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;err&quot;</span>&#125;)<br>		c.Abort()<br>		<span class="hljs-keyword">return</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	中间件函数接收一个 Gin 上下文对象（<code>gin.Context</code>），并返回一个 <code>gin.HandlerFunc</code> 类型的函数。中间件函数首先检查请求头中是否包含名为 <code>constant.SessionKey</code> 的 cookie。</p>
<p>​	如果 cookie 存在且不为空，则说明用户已经登录，调用 <code>c.Next()</code> 方法，继续处理该请求并传递给后续处理程序；否则，中间件函数返回一个状态码为 <code>http.StatusUnauthorized</code> 的 JSON 响应，提示用户未授权，并终止该请求的处理，调用 <code>c.Abort()</code> 方法终止后续处理程序函数的执行。</p>
<h4 id="③InitRouterAndServe"><a href="#③InitRouterAndServe" class="headerlink" title="③InitRouterAndServe"></a>③InitRouterAndServe</h4><p>​	函数路由配置、启动服务</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitRouterAndServe</span><span class="hljs-params">()</span></span> &#123;<br><br>	setAppRunMode()<br>	r := gin.Default()<br><br>	<span class="hljs-comment">// 健康检查</span><br>	r.GET(<span class="hljs-string">&quot;ping&quot;</span>, api.Ping)<br>	<span class="hljs-comment">//健康检查</span><br>	<span class="hljs-comment">// 用户注册</span><br>	r.POST(<span class="hljs-string">&quot;/user/register&quot;</span>, api.Register)<br>	<span class="hljs-comment">// 用户登录</span><br>	r.POST(<span class="hljs-string">&quot;/user/login&quot;</span>, api.Login)<br>	<span class="hljs-comment">// 用户登出</span><br>	r.POST(<span class="hljs-string">&quot;/user/logout&quot;</span>, AuthMiddleWare(), api.Logout)<br>	<span class="hljs-comment">// 获取用户信息</span><br>	r.GET(<span class="hljs-string">&quot;/user/get_user_info&quot;</span>, AuthMiddleWare(), api.GetUserInfo)<br>	<span class="hljs-comment">// 更新用户信息</span><br>	r.POST(<span class="hljs-string">&quot;/user/update_nick_name&quot;</span>, AuthMiddleWare(), api.UpdateNickName)<br><br>	r.Static(<span class="hljs-string">&quot;/static/&quot;</span>, <span class="hljs-string">&quot;./web/static/&quot;</span>)<br>	r.Static(<span class="hljs-string">&quot;/upload/images/&quot;</span>, <span class="hljs-string">&quot;./web/upload/images/&quot;</span>)<br><br>	<span class="hljs-comment">// 启动server</span><br>	port := config.GetGlobalConf().AppConfig.Port<br>	<span class="hljs-keyword">if</span> err := r.Run(<span class="hljs-string">&quot;:&quot;</span> + strconv.Itoa(port)); err != <span class="hljs-literal">nil</span> &#123;<br>		log.Error(<span class="hljs-string">&quot;start server err:&quot;</span> + err.Error())<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	这个函数主要是初始化路由并启动HTTP server。</p>
<p>​	首先调用<code>setAppRunMode()</code>函数来设置Gin框架的运行模式。然后创建一个默认的Gin实例，并使用<code>GET</code>方法注册了一个名为”ping”的路由，并将其处理函数设置为<code>api.Ping</code>，该函数用于实现健康检查。</p>
<p>​	接下来注册了一系列处理用户相关操作的路由，如注册、登录、登出、获取用户信息以及更新用户昵称等。其中，访问需要用户授权的路由时，使用了<code>AuthMiddleWare()</code>中间件函数来验证用户的登录状态。</p>
<p>​	最后，使用<code>r.Static()</code>函数注册了静态文件服务，指定了静态文件的路径。最后启动HTTP server，并指定了端口号。如果启动失败，将会输出错误信息到日志中。</p>
<h4 id="完整代码-2"><a href="#完整代码-2" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> router<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	log <span class="hljs-string">&quot;github.com/sirupsen/logrus&quot;</span><br>	<span class="hljs-string">&quot;net/http&quot;</span><br>	<span class="hljs-string">&quot;strconv&quot;</span><br>	api <span class="hljs-string">&quot;user_system/api/http/v1&quot;</span><br>	<span class="hljs-string">&quot;user_system/config&quot;</span><br>	<span class="hljs-string">&quot;user_system/pkg/constant&quot;</span><br>)<br><br><span class="hljs-comment">// InitRouterAndServe 路由配置、启动服务</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitRouterAndServe</span><span class="hljs-params">()</span></span> &#123;<br><br>	setAppRunMode()<br>	r := gin.Default()<br><br>	<span class="hljs-comment">// 健康检查</span><br>	r.GET(<span class="hljs-string">&quot;ping&quot;</span>, api.Ping)<br>	<span class="hljs-comment">//健康检查</span><br>	<span class="hljs-comment">// 用户注册</span><br>	r.POST(<span class="hljs-string">&quot;/user/register&quot;</span>, api.Register)<br>	<span class="hljs-comment">// 用户登录</span><br>	r.POST(<span class="hljs-string">&quot;/user/login&quot;</span>, api.Login)<br>	<span class="hljs-comment">// 用户登出</span><br>	r.POST(<span class="hljs-string">&quot;/user/logout&quot;</span>, AuthMiddleWare(), api.Logout)<br>	<span class="hljs-comment">// 获取用户信息</span><br>	r.GET(<span class="hljs-string">&quot;/user/get_user_info&quot;</span>, AuthMiddleWare(), api.GetUserInfo)<br>	<span class="hljs-comment">// 更新用户信息</span><br>	r.POST(<span class="hljs-string">&quot;/user/update_nick_name&quot;</span>, AuthMiddleWare(), api.UpdateNickName)<br><br>	r.Static(<span class="hljs-string">&quot;/static/&quot;</span>, <span class="hljs-string">&quot;./web/static/&quot;</span>)<br>	r.Static(<span class="hljs-string">&quot;/upload/images/&quot;</span>, <span class="hljs-string">&quot;./web/upload/images/&quot;</span>)<br><br>	<span class="hljs-comment">// 启动server</span><br>	port := config.GetGlobalConf().AppConfig.Port<br>	<span class="hljs-keyword">if</span> err := r.Run(<span class="hljs-string">&quot;:&quot;</span> + strconv.Itoa(port)); err != <span class="hljs-literal">nil</span> &#123;<br>		log.Error(<span class="hljs-string">&quot;start server err:&quot;</span> + err.Error())<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// setAppRunMode 设置运行模式</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setAppRunMode</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-keyword">if</span> config.GetGlobalConf().AppConfig.RunMode == <span class="hljs-string">&quot;release&quot;</span> &#123;<br>		gin.SetMode(gin.ReleaseMode)<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AuthMiddleWare</span><span class="hljs-params">()</span></span> gin.HandlerFunc &#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		<span class="hljs-keyword">if</span> session, err := c.Cookie(constant.SessionKey); err == <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-keyword">if</span> session != <span class="hljs-string">&quot;&quot;</span> &#123;<br>				c.Next()<br>				<span class="hljs-keyword">return</span><br>			&#125;<br>		&#125;<br>		<span class="hljs-comment">// 返回错误</span><br>		c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;err&quot;</span>&#125;)<br>		c.Abort()<br>		<span class="hljs-keyword">return</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="（2）model包"><a href="#（2）model包" class="headerlink" title="（2）model包"></a>（2）model包</h3><h4 id="①model-go"><a href="#①model-go" class="headerlink" title="①	model.go"></a>①	model.go</h4><h5 id="CreateModel类型内嵌model"><a href="#CreateModel类型内嵌model" class="headerlink" title="CreateModel类型	内嵌model"></a>CreateModel类型	内嵌model</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> CreateModel <span class="hljs-keyword">struct</span> &#123;<br>	Creator    <span class="hljs-type">string</span>    <span class="hljs-string">`gorm:&quot;type:varchar(100);not null;default &#x27;&#x27;&quot;`</span><br>	CreateTime time.Time <span class="hljs-string">`gorm:&quot;autoCreateTime&quot;`</span> <span class="hljs-comment">// 在创建记录时自动生成时间</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	这个是一个 Golang 结构体定义，用于定义一个数据表模型。其中 <code>CreateModel</code> 表示一个模型，它包含了两个字段：</p>
<p>​	a.<code>Creator</code>：表示模型的创建者，类型为字符串，占用数据库中的 <code>varchar(100)</code> 类型，不允许为空，如果不填则默认为空字符串。</p>
<p>​	b.<code>CreateTime</code>：表示模型的创建时间，类型为 <code>time.Time</code>，它是在创建记录时自动生成的时间。</p>
<p>这个模型是使用 GORM 框架来操作数据库的，通过在字段的 tag 中指定各种约束条件，例如 <code>type</code>、<code>not null</code>、<code>default</code>、<code>autoCreateTime</code> 等来指定该字段在数据库中的属性和行为。</p>
<h5 id="ModifyModel类型内嵌model"><a href="#ModifyModel类型内嵌model" class="headerlink" title="ModifyModel类型	内嵌model"></a>ModifyModel类型	内嵌model</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> ModifyModel <span class="hljs-keyword">struct</span> &#123;<br>   Modifier   <span class="hljs-type">string</span>    <span class="hljs-string">`gorm:&quot;type:varchar(100);not null;default &#x27;&#x27;&quot;`</span><br>   ModifyTime time.Time <span class="hljs-string">`gorm:&quot;autoUpdateTime&quot;`</span> <span class="hljs-comment">// 在更新记录时自动生成时间</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	这是一个包含<code>Modifier</code>和<code>ModifyTime</code>字段的结构体，用于对记录进行更新时自动记录修改者和修改时间。</p>
<p>​	<code>Modifier</code>字段是一个<code>string</code>类型，用于记录更新操作的人员，<code>gorm:&quot;type:varchar(100);not null;default &#39;&#39;&quot;</code>表示该字段在数据库中对应的类型为<code>varchar(100)</code>，不能为空，并且默认值为<code>&#39;&#39;</code>。</p>
<p>​	<code>ModifyTime</code>字段是一个<code>time.Time</code>类型，用于记录更新操作的时间，<code>gorm:&quot;autoUpdateTime&quot;</code>表示该字段在更新记录时会自动更新为当前时间。当记录被更新时，<code>gorm</code>会自动将当前时间赋值给<code>ModifyTime</code>字段。</p>
<p>​	这种方式可以方便地记录记录的修改者和修改时间，且不需要手动在代码中添加修改者和修改时间的记录。同时，由于<code>gorm</code>自动更新时间的特性，确保了记录的修改时间的准确性。</p>
<h5 id="User类型用户"><a href="#User类型用户" class="headerlink" title="User类型	用户"></a>User类型	用户</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	CreateModel<br>	ModifyModel<br>	ID       <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:&quot;column:id&quot;`</span><br>	Name     <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;column:name&quot;`</span>     <span class="hljs-comment">//姓名</span><br>	Gender   <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;column:gender&quot;`</span>   <span class="hljs-comment">//性别</span><br>	Age      <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:&quot;column:age&quot;`</span>      <span class="hljs-comment">//年龄</span><br>	PassWord <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;column:password&quot;`</span> <span class="hljs-comment">//密码</span><br>	NickName <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;column:nickname&quot;`</span> <span class="hljs-comment">//昵称</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	定义了一个结构体 <code>User</code>，其中包含了 <code>CreateModel</code> 和 <code>ModifyModel</code> 两个嵌套的结构体。</p>
<p>​	<code>CreateModel</code> 结构体中包含了一个字段 <code>CreateTime</code>，它的类型为 <code>time.Time</code>，表示创建记录时自动生成的时间。</p>
<p>​	<code>ModifyModel</code> 结构体中包含了一个字段 <code>ModifyTime</code>，它的类型也为 <code>time.Time</code>，表示更新记录时自动生成的时间。</p>
<p>​	<code>User</code> 结构体中还包含了其他字段，如 <code>ID</code>、<code>Name</code>、<code>Gender</code>、<code>Age</code>、<code>PassWord</code> 和 <code>NickName</code> 等字段，这些字段可以通过在数据库中创建对应的列来存储数据。同时，由于 <code>User</code> 结构体嵌套了 <code>CreateModel</code> 和 <code>ModifyModel</code> 结构体，因此在插入或更新 <code>User</code> 记录时，相应的时间字段会自动填充为当前时间。</p>
<h5 id="TableName-表名"><a href="#TableName-表名" class="headerlink" title="TableName 表名"></a>TableName 表名</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *User)</span></span> TableName() <span class="hljs-type">string</span> &#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;t_user&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	这是一个 GORM 模型结构体方法，用于指定模型对应的数据库表名。在这个例子中，<code>User</code> 模型对应的数据库表名为 <code>t_user</code>。这个方法的作用是将模型和表名进行绑定，使得 GORM 可以自动地将模型的数据存储到对应的数据库表中。如果没有显式指定表名，则 GORM 会默认使用模型名的复数形式作为表名。</p>
<h3 id="（3）dao包"><a href="#（3）dao包" class="headerlink" title="（3）dao包"></a>（3）dao包</h3><h4 id="①user-go"><a href="#①user-go" class="headerlink" title="①	user.go"></a>①	user.go</h4><h5 id="CreateUser函数创建一个用户"><a href="#CreateUser函数创建一个用户" class="headerlink" title="CreateUser函数	创建一个用户"></a>CreateUser函数	创建一个用户</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CreateUser</span><span class="hljs-params">(user *model.User)</span></span> <span class="hljs-type">error</span> &#123;<br>	<span class="hljs-keyword">if</span> err := utils.GetDB().Model(&amp;model.User&#123;&#125;).Create(user).Error; err != <span class="hljs-literal">nil</span> &#123;<br>		log.Errorf(<span class="hljs-string">&quot;CreateUser fail: %v&quot;</span>, err)<br>		<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;CreateUser fail: %v&quot;</span>, err)<br>	&#125;<br>	log.Infof(<span class="hljs-string">&quot;insert success&quot;</span>)<br>	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	用于在数据库中创建一个新的用户记录。函数接受一个指向model.User类型结构体的指针作为参数，该结构体表示一个用户的数据。</p>
<p>​	函数首先使用utils包中的GetDB函数获取一个数据库对象，并使用该对象的Model方法指定要操作的数据库表（model.User{}表示t_user表）。然后，它使用该表的Create方法来将传入的user结构体创建为一条新记录。如果创建过程中出现错误，函数会记录一个错误日志，并返回一个错误。否则，函数记录一个成功的信息日志并返回nil表示没有错误。</p>
<h5 id="GetUserByName函数根据姓名获取用户"><a href="#GetUserByName函数根据姓名获取用户" class="headerlink" title="GetUserByName函数	根据姓名获取用户"></a>GetUserByName函数	根据姓名获取用户</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetUserByName</span><span class="hljs-params">(name <span class="hljs-type">string</span>)</span></span> (*model.User, <span class="hljs-type">error</span>) &#123;<br>	user := &amp;model.User&#123;&#125;<br>	<span class="hljs-keyword">if</span> err := utils.GetDB().Model(model.User&#123;&#125;).Where(<span class="hljs-string">&quot;name=?&quot;</span>, name).First(user).Error; err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">if</span> err.Error() == gorm.ErrRecordNotFound.Error() &#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span><br>		&#125;<br>		log.Errorf(<span class="hljs-string">&quot;GetUserByName fail:%v&quot;</span>, err)<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;GetUserByName fail:%v&quot;</span>, err)<br>	&#125;<br>	<span class="hljs-keyword">return</span> user, <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	该函数用于从数据库中查找一个指定名称的用户，并返回一个指向该用户的指针。如果找不到该用户，则返回nil。</p>
<p>​	它采用一个名称字符串作为输入参数，并使用该参数在数据库中查询匹配的用户记录。如果查询成功，它将返回指向用户记录的指针；否则，它将返回一个错误，该错误将描述查询失败的原因。</p>
<p>​	在该函数内部，它使用了<code>gorm</code>库提供的方法来查询数据库，并将查询结果存储在一个指向<code>User</code>结构体的指针中。如果查询未能返回任何结果，即指定名称的用户不存在，则该函数将返回nil。否则，它将返回一个指向包含匹配用户信息的结构体的指针。</p>
<h5 id="UpdateUserInfo-更新昵称"><a href="#UpdateUserInfo-更新昵称" class="headerlink" title="UpdateUserInfo 更新昵称"></a>UpdateUserInfo 更新昵称</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">UpdateUserInfo</span><span class="hljs-params">(userName <span class="hljs-type">string</span>, user *model.User)</span></span> <span class="hljs-type">int64</span> &#123;<br>	<span class="hljs-keyword">return</span> utils.GetDB().Model(&amp;model.User&#123;&#125;).Where(<span class="hljs-string">&quot;`name` = ?&quot;</span>, userName).Updates(user).RowsAffected<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​	这个函数的功能是更新数据库中用户信息。它接收两个参数，一个是userName，代表要更新信息的用户的用户名；另一个是user指针，它是要更新的用户信息。</p>
<p>​	在函数内部，使用<code>utils.GetDB()</code>方法获取数据库连接对象，然后使用<code>Model</code>方法指定操作的数据表。<code>Where</code>方法根据指定的用户名查询要更新的用户信息，并使用<code>Updates</code>方法将用户信息更新到数据库中。最后，<code>RowsAffected</code>方法返回更新的行数。</p>
<p>​	这个函数的返回值是更新的行数，可以用于判断更新是否成功。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Go/" class="category-chain-item">Go</a>
  
  
    <span>></span>
    
  <a href="/categories/Go/user-system/" class="category-chain-item">user_system</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/GO/">#GO</a>
      
        <a href="/tags/%E9%A1%B9%E7%9B%AE/">#项目</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>user_system项目</div>
      <div>http://example.com/2023/04/18/user-system项目/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Feng Tao</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年4月18日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2023年4月18日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/04/17/%E5%88%B7%E9%A2%98/%E6%9C%80%E5%A4%A7%E4%B8%8A%E5%8D%87%E5%AD%90%E5%BA%8F%E5%88%97%E5%92%8C/" title="最大上升子序列和">
                        <span class="hidden-mobile">最大上升子序列和</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"lBwkKPHSowjEDFhKBLK0YCvo-gzGzoHsz","appKey":"vX99TJqyX7lpdiEcliqnCW51","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
